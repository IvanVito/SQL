# Отчет по заданию "Day 09 - Piscine SQL"

В этот день я создавал и использовал функциональные блоки в базах данных PostgreSQL, а именно реализации аудит-триггеров и функций для улучшения управления данными. В процессе выполнения задания были выполнены следующие шаги:

1. Прочитал правила и инструкции, убедился, что использую актуальную версию PostgreSQL.
2. Убедился, что использую актуальную версию PostgreSQL и подготовил свою базу данных с помощью предоставленного скрипта `model.sql`.
3. Выполнение упражнений:

    **ex00: Аудит входящих вставок**
    - Создал таблицу `person_audit` для хранения информации о вставках в таблицу `person`. Таблица включает дополнительные атрибуты: `created` (время создания записи), `type_event` (тип события), и `row_id` (идентификатор строки из оригинальной таблицы). 
    - Реализовал функцию-триггер `fnc_trg_person_insert_audit`, которая автоматически записывает данные о новых вставках в таблицу `person_audit`. 
    - Создал триггер `trg_person_insert_audit` для вызова вышеуказанной функции после вставки новых записей в таблицу `person`.

    **ex01: Аудит входящих обновлений**
    - Реализовал функцию-триггер `fnc_trg_person_update_audit`, которая фиксирует старые значения обновленных записей в таблице `person` и записывает их в `person_audit`.
    - Создал триггер `trg_person_update_audit`, который срабатывает после обновления записей в таблице `person`.

    **ex02: Аудит входящих удалений**
    - Создал функцию-триггер `fnc_trg_person_delete_audit`, которая записывает данные о удаленных записях из таблицы `person` в `person_audit`.
    - Реализовал триггер `trg_person_delete_audit`, который срабатывает после удаления записей из таблицы `person`.

    **ex03: Универсальный аудит**
    - Объединил логику аудита для операций `INSERT`, `UPDATE` и `DELETE` в одну функцию `fnc_trg_person_audit`. 
    - Удалил старые триггеры и функции, и создал один триггер `trg_person_audit`, который вызывает универсальную функцию аудита.

    **ex04: Представление базы данных против функции базы данных**
    - Создал две SQL-функции `fnc_persons_female` и `fnc_persons_male` для возврата данных о людях в зависимости от их пола.
    - Выполнил тестовые запросы к этим функциям для проверки их работы.

    **ex05: Параметризованная функция базы данных**
    - Удалил ранее созданные функции и создал обобщенную функцию `fnc_persons`, которая принимает параметр `pgender` и возвращает данные в зависимости от значения этого параметра.
    - Проверил работу функции с различными параметрами.

    **ex06: Функция как обертка функции**
    - Создал pl/pgsql функцию `fnc_person_visits_and_eats_on_date`, которая находит пиццерии, которые посетил человек и где он мог купить пиццу по цене ниже заданной на указанную дату.
    - Протестировал функцию с разными параметрами.

    **ex07: Различный способ нахождения минимума**
    - Создал SQL или pl/pgsql функцию `func_minimum`, которая принимает массив чисел и возвращает минимальное значение.
    - Протестировал функцию с различными массивами чисел.

    **ex08: Алгоритм Фибоначчи в функции**
    - Реализовал SQL или pl/pgsql функцию `fnc_fibonacci`, которая генерирует все числа Фибоначчи до заданного значения.
    - Выполнил тестовые запросы к функции с различными параметрами.

3. **Заключение:**
   - В ходе выполнения задания я освоил создание и использование триггеров, функций и представлений в PostgreSQL для улучшения работы с данными.
   - Эти знания помогут мне в разработке эффективных решений для управления данными в реальных проектах, улучшая их целостность и функциональность.
