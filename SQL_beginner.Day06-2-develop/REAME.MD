# Отчет по заданию "Day 06 - Piscine SQL"

Я сосредоточился на добавлении новых бизнес-функций в нашу модель данных и улучшении ее структуры, выполнил следующие шаги:

1. Ознакомился с правилами выполнения задания и настройкой окружения PostgreSQL.
2. Применил скрипт для создания базы данных с нужной схемой.
3. Выполнил упражнения, касающиеся добавления новой функциональности и улучшения модели данных:

    **ex00 :**
    - Создал новую таблицу `person_discounts` для хранения информации о скидках. Таблица включает следующие атрибуты: `id`, `person_id`, `pizzeria_id`, и `discount`. Установил `id` как первичный ключ, а `person_id` и `pizzeria_id` как внешние ключи. Использовал тип данных `numeric` для хранения значений скидок с плавающей точкой и установил явные имена ограничений для внешних ключей.

    **ex01 :**
    - Написал SQL-запрос для вставки записей в таблицу `person_discounts` на основе данных из таблицы `person_order`. Использовал агрегированные данные по `person_id` и `pizzeria_id` для вычисления значений скидок. Применил функцию `ROW_NUMBER()` для генерации уникальных идентификаторов.

    **ex02 :**
    - Создал SQL-запрос для расчета и отображения цен на пиццу с учетом скидок для каждого человека и пиццерии. Результаты сортированы по имени человека и названию пиццы, что позволяет увидеть окончательные цены и примененные скидки.

    **ex03 :**
    - Создал многоколонный уникальный индекс `idx_person_discounts_unique`, чтобы предотвратить дублирование записей в таблице `person_discounts`. Проверил использование индекса с помощью команды `EXPLAIN ANALYZE`, что подтвердило его правильную работу и улучшение производительности.

    **ex04 :**
    - Добавил ограничения для столбцов таблицы `person_discounts`, включая обязательные поля (не допускающие NULL) и проверку диапазона значений скидки. Установил значения по умолчанию и применил необходимые ограничения для обеспечения консистентности данных.

    **ex05 :**
    - Добавил комментарии к таблице `person_discounts` и ее столбцам, чтобы объяснить бизнес-цели таблицы и назначение каждого атрибута. Комментарии включают информацию о функциональном назначении скидок и связях между таблицами.

    **ex06 :**
    - Создал последовательность `seq_person_discounts` для автоматической генерации значений первичного ключа в таблице `person_discounts`. Установил начальное значение последовательности и скорректировал его в зависимости от текущего числа строк в таблице, чтобы избежать ошибок нарушения ограничения первичного ключа.

В ходе выполнения задания я изучил и применил методы для улучшения функциональности и консистентности модели данных, включая создание и использование внешних ключей, индексов и последовательностей. Это знание поможет эффективно управлять данными и обеспечивать их целостность в реальных проектах.